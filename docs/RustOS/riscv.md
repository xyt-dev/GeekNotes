---
title: riscv
---

# riscv

## ABI

ABI 即 Application binary interface, 是硬件层面的两段程序间调用的接口, 由处理器体系结构规定.
其内容包括:
- 数据类型(处理器使用的基本类型)的大小、字段表示、对齐方式等.
- 调用约定(控制函数如何传送和接受返回值), 包括寄存器使用约定、参数传递顺序等. (栈的增长方向和内存逻辑地址布局由操作系统规定)
- 如何进行系统调用.
- 其他

### 寄存器及其使用约定

riscv共有32个整数寄存器:

| <div style="width:60px;">寄存器别名</div> | <div style="width:60px;">寄存器</div> | <div style="width:86px;">描述</div> | <div style="width:106px;">保存责任</div> | 说明 |
| - | - | - | - | - |
| zero | x0 | 零寄存器 | 无需保存 | 值恒为0, 一般用于清零操作. |
| ra | x1 | 返回地址 | 调用者保存 | 使用跳转指令会自动赋值返回地址给`ra`寄存器, `ret`指令会自动跳转回`ra`指向的地址; 调用者必须主动保存其原返回地址. |
| sp | x2 | 栈指针 | 被调用者保存 | 指向当前栈顶, 函数调用时由被调用者保存和恢复. |
| gp | x3 | 全局指针 | 无需显式保存 | 指向全局数据区域基地址, 通常在进程启动时由操作系统/启动代码初始化, 进程上下文切换时由操作系统保存和恢复, 无需在函数调用时保存. |
| tp | x4 | 线程指针 | 无需显式保存 | 指向线程局部存储(TLS)区域基地址, 通常在线程创建时由操作系统/线程库初始化, 线程上下文切换时由操作系统保存和恢复, 无需在函数调用时保存. |
| t0-t2, t3-t6 | x5-x7, x28-x31 | 临时寄存器 | 无保存责任 | 调用者可直接使用, 无需保存, 分为`t0-t2`,`t3-t6`两组. |
| s0-s1, s2-s11 | x8-x9, x18-x27 | 保存寄存器 | 被调用者保存 | 被调用者需在函数开始时保存、在函数返回前恢复所使用到的寄存器值, 分为`s0-s1`, `s2-s11`两组. |
| a0-a7 | x10-x17 | 参数/返回值寄存器 | 调用者保存 | 其中`a0-a7`可用于函数调用传参(前8个参数), `a0-a1`可用于保存返回值. 调用者使用`a0-a7`传参前需主动保存其中的值, 函数返回后(且读取返回值后)恢复使用到的`a0-a7`寄存器的值. |